'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,f,e){d!=Array.prototype&&d!=Object.prototype&&(d[f]=e.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(d,f,e,k){if(f){e=$jscomp.global;d=d.split(".");for(k=0;k<d.length-1;k++){var h=d[k];h in e||(e[h]={});e=e[h]}d=d[d.length-1];k=e[d];f=f(k);f!=k&&null!=f&&$jscomp.defineProperty(e,d,{configurable:!0,writable:!0,value:f})}};$jscomp.polyfill("Array.prototype.includes",function(d){return d?d:function(d,e){var f=this;f instanceof String&&(f=String(f));var h=f.length;e=e||0;for(0>e&&(e=Math.max(e+h,0));e<h;e++){var q=f[e];if(q===d||Object.is(q,d))return!0}return!1}},"es7","es3");
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var d=0;return function(f){return $jscomp.SYMBOL_PREFIX+(f||"")+d++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(d){var f=0;return $jscomp.iteratorPrototype(function(){return f<d.length?{done:!1,value:d[f++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};$jscomp.iteratorFromArray=function(d,f){$jscomp.initSymbolIterator();d instanceof String&&(d+="");var e=0,k={next:function(){if(e<d.length){var h=e++;return{value:f(h,d[h]),done:!1}}k.next=function(){return{done:!0,value:void 0}};return k.next()}};k[Symbol.iterator]=function(){return k};return k};
$jscomp.polyfill("Array.prototype.values",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(d,e){return e})}},"es8","es3");
var Dag=function(){function*d(a){for(a=a?a+1:0;;)yield a++}const f=(...a)=>{},e=(...a)=>!1;(new Map).set("true",!0).set("false",!1);const k=(a)=>void 0!==a,h=(a)=>"number"===typeof a&&!Number.isNaN(a),q=(a,b)=>a.length===b.length&&a.every((a,g)=>b[g]===a),v=(a,b)=>(c)=>{c=b.reduce((a,b)=>{try{if(null===b)var c=b;else{var g=1*b;c=Number.isNaN(g)?b:g}return a[c]}catch(u){}},c);return void 0===c?a:c},w=(a)=>{const b=Math.pow(10,a);return(a)=>Math.round(a*b)/b},m=(a)=>"string"===typeof a&&!Number.isNaN(parseInt(a.split("$").join(""),
10)-1),F=(a,b)=>a.filter((a)=>a[0]!==b),G=(a)=>{let b;try{b=JSON.parse(a)}catch(c){}return b},H=new Map([["!=",(a,b)=>a!=b],["==",(a,b)=>a==b],["!==",(a,b)=>a!==b],["===",(a,b)=>a===b],["<=",(a,b)=>a<=b],[">=",(a,b)=>a>=b],["<",(a,b)=>a<b],[">",(a,b)=>a>b]]),x=new Map([["vu",(a,b,c)=>a?b:void 0],["10",(a,b,c)=>a?1:0],["tf",(a,b,c)=>a],["ab",(a,b,c)=>a?b:c]]),I=(a)=>{const b=[..."+-*/%()".split(""),..."0123456789.".split(""),...["$"," ","'"],..."& | ^ ~ << >> >>>".split(" "),...["int","len"]];return[...a].filter((a)=>
b.includes(a)).join("")},y=(a)=>{try{return[null,new Function("X",['const len = e => ("" + e).length;const int = e => parseInt(e, 10);',`try {return ${a};}catch(e){return;}`].join(""))]}catch(b){return[`Could not make a function with "${a}"`,f]}},J=(a,b)=>{let c="Unable to clean math",g=f;"string"===typeof a?(a=b.reduce((a,b,c)=>a.split(`$${c+1}`).join(`${"X"}.get(${b})`),I(a)),a.includes("$")||([c,g]=y(a))):[c,g]=y(a);return[c,g]},K=(a,b)=>{a=a.map(([a,c])=>{if("string"===typeof c&&m(c)){const g=
parseInt(c.split("$").join(""),10)-1;return[a,(a)=>a.get(b[g])]}return[a,()=>c]});const c=new Map(a);return[null,(a)=>{const g=c.get(a.get(b[0]));return g?g(a):void 0}]},L=(a,b)=>{const c=w(a);return[null,(a)=>c(a.get(b[0]))]},p=(a,b)=>{let c;if("string"===typeof a){const g=parseInt(a.split("$").join(""),10)-1;c=(a)=>a.get(b[g])}else c=()=>a;return c},M=(a,b)=>{const [c,g,d,n]=a,r=p(c,b),u=p(d,b),h=H.get(g)||e,k=x.get(n)||f;return[null,(a)=>{const [b,c]=[r(a),u(a)];return k(h(b,c),b,c)}]},N=(a,b)=>
{let [c,g,d,n]=a;const r=p(c,b),e=p(g,b),h=p(d,b),k=x.get(n)||f;return[null,(a)=>{const [b,c,g]=[r(a),e(a),h(a)],[d,t]=[Math.min(c,g),Math.max(c,g)];return b>=d&&b<=t?k(!0,b,d):b>=d?k(!1,b,t):k(!1,b,d)}]},O=(a,b)=>[null,q(a,[null])?(a)=>a.get(b.length?b[0]:"data"):(c)=>v(void 0,a)(c.get(b.length?b[0]:"data"))],P=([a,b],c)=>{const g=["_ev",a.toString(),b];return[null,(a)=>v(void 0,g)(a.get("data"))]},z=(a,b)=>[null,()=>a],Q=(new Map).set("Math",(a)=>void 0!==a.math).set("Enumerator",(a)=>a.enum&&a.enum.length).set("Rounding",
(a)=>void 0!==a.round).set("Comparator",(a)=>a.comparator&&a.comparator.length).set("Range",(a)=>a.between&&a.between.length).set("Data Access",(a)=>a.path&&a.path.length).set("Event Access",(a)=>a.evCode&&2===a.evCode.length).set("Constant",(a)=>void 0!==a.fallback),R=(new Map).set("Math",(a)=>J(a.math,a.args)).set("Enumerator",(a)=>K(a.enum,a.args)).set("Rounding",(a)=>L(a.round,a.args)).set("Comparator",(a)=>M(a.comparator,a.args)).set("Range",(a)=>N(a.between,a.args)).set("Data Access",(a)=>O(a.path,
a.args)).set("Event Access",(a)=>P(a.evCode,a.args)).set("Constant",(a)=>z(a.fallback,a.args)).set(void 0,(a)=>z(a.fallback,a.args)),S=(new Map).set("Math",(a)=>a.math).set("Enumerator",(a)=>a.enum.map(([a,c])=>`{${a} \ud83e\udc1a ${c}}`).join("|")).set("Rounding",(a)=>a.round).set("Comparator",(a)=>a.comparator.join(" ").replace(/([<>])/gi,String.raw`$1`)).set("Range",(a)=>a.between.join(" ")).set("Data Access",(a)=>a.path.join(" ")).set("Event Access",(a)=>a.evCode.join(" ")).set("Constant",(a)=>
a.fallback).set(void 0,(a)=>"Not Configured");class l{constructor(a,b,c=void 0){this._id=a;this._name=b;this._args=[];this._math=void 0;this._enum=[];this._comparator=[];this._between=[];this._round=void 0;this._path=[];this._evCode=[];this._fallback=void 0;this._nodus="Not init";this._func=f;c&&(this._id=c.I,this.name=c.N,this.setFallback(c.D),this.setMath(c.M),c.E.forEach((a)=>{a&&this.addEnum(...a)}),this.setRound(c.R),this.setPath(...c.P),this.setComparator(...c.C),this.setBetween(...c.B),this.setEvCode(...c.V))}dump(){return{A:this._args,
B:this._between,C:this._comparator,D:this._fallback,E:this._enum,I:this.id,M:this._math,N:this.name,P:this._path,R:this._round,V:this._evCode}}_clearAll(a=!0){this._path=[];this._enum=a?[]:this._enum;this._comparator=[];this._between=[];this._evCode=[];this._math=this._round=void 0;this._nodus="Changed"}reset(){this._clearAll(!0);this._fallback=void 0;this._nodus="Not init"}get id(){return this._id}get descr(){return S.get(this.type)(this)}get name(){return this._name}set name(a){this._name=a}get type(){const a=
[...Q.entries()].find(([,a])=>a(this));return a?a[0]:void 0}addArg(a){this._args.push(a._id);this._nodus="Args added";return this}delArg(a){this._args=this._args.filter((b)=>b!==a._id);this._nodus="Args removed";return this}get args(){return this._args}setAllArgs(a){Array.isArray(a)&&a.every(h)&&(this._args=a)}setFallback(a){this._fallback=a;return this}get fallback(){return this._fallback}setEvCode(a,b){if(void 0!==a){this._clearAll();let c="data";b&&(b=b.toLowerCase(),c=["data","desc","code"].includes(b)?
b:c);this._evCode=[a,c]}return this}get evCode(){return this._evCode}setPath(...a){[...a].length&&[...a].every(k)&&(this._clearAll(),this._path=[...a]);return this}get path(){return this._path}setMath(a){void 0!==a&&(this._clearAll(),this._math=a);return this}get math(){return this._math}setRound(a){h(a)&&(this._clearAll(),this._round=w(0)(a));return this}get round(){return this._round}setComparator(a,b,c,d){let g=!0;g=(h(a)||m(a))&&g;g=(h(c)||m(c))&&g;g="!= !== == === <= >= < >".split(" ").includes(b)&&
g;if(g=["vu","10","tf","ab"].includes(d)&&g)this._clearAll(),this._comparator=[a,b,c,d];return this}get comparator(){return this._comparator}setBetween(a,b,c,g){let d=!0;d=(h(a)||m(a))&&d;d=(h(b)||m(b))&&d;d=(h(c)||m(c))&&d;if(d=["vu","10","tf","ab"].includes(g)&&d)this._clearAll(),this._between=[a,b,c,g];return this}get between(){return this._between}addEnum(a,b){if(void 0===a)return this;this._clearAll(!1);this._enum=[...(new Map(this._enum)).set(a,b).entries()];return this}delEnum(a){this._enum=
F(this._enum,a);this._nodus="Changed";return this}get enum(){return this._enum}clean(){const [a,b]=R.get(this.type)(this);this._nodus=a;this._func=b;return this}solve(a){if(this._nodus)this.clean();else{const b=this._func(a);return a.set(this._id,void 0===b?this.fallback:b)}return this._nodus?(a.set(this._id,void 0),a.set(`err_${this._id}`,!this._nodus),a):this.solve(a)}static isIn(a){return(b,[c,d])=>d.has(a)?b.push(c)&&b:b}}const T=(a)=>(b)=>{const c=b.id,d=b.name,f="ROOT"===d?"Root":b.type,n="ROOT"===
d?"Final":b.descr,e=b.args.map((a,b)=>`<${a}>$${b+1}`).join("|");b=(b=b.fallback)?`|Default: ${b}`:"";const h=a?`|${a.get(c)}`:"";return`${c} [label="{{${e}}|${f}|${n}|{ID:${c}|${d}}${b}${h}}"];`},U=(a)=>(b,c)=>{const d=a?a.get(b.id):"";return`${b.id} -> ${c.id}:${b.id}[label="${d}"]`},V=(a,b)=>{const c=U(b),d=[...a.G.entries()].reduce((a,[b,c])=>[...a,...[...c].map((a)=>[b,a])],[]).map(([a,b])=>c(a,b)).reduce((a,b)=>`${a} ${b};`,"");b=T(b);b=a.nodes.map(b).join(" ");let f=a.description;f=a.units.trim().length?
`${f} - ${a.units}`:f;return["digraph { node [shape=record];",`label = "${f}";`,`${b}`,`${d}`,"}"].join(" ")},A=(a)=>a.id,B=(a)=>{const b=[...a.keys()].reduce((a,b)=>a.set(b,0)||a,new Map);[...a.values()].forEach((a)=>a.forEach((a)=>b.set(a,b.has(a)?b.get(a)+1:0)));a=[...a.keys()].filter((a)=>0===b.get(a));return{C:b,Q:a}},W=(a)=>{const {C:b,Q:c}=B(a),d=[];for(;c.length;){const g=c.pop();d.push(g);a.get(g).forEach((a)=>{b.set(a,b.get(a)-1);0===b.get(a)&&c.push(a)})}return d},C=(a)=>{for(const [b,
c]of a.entries())if(0===c.size&&0!==b){a.delete(b);for(const c of a.values())c.delete(b)}[...a.entries()].reduce((a,c)=>a||0===c[1].size&&0!==c[0],!1)&&C(a);return a},D=(a)=>(b)=>new l(a.next().value,b);class E{constructor(a,b){this._meta=null;this._ref=this.ref=void 0!==b?b:null;this._description=this.description="string"===typeof a?a:"";this._units="";this.G=new Map;this._nodeMaker=D(d());this._rootNode=this.makeNode("ROOT");this._rootNode.setMath("$1")}get meta(){return this._meta}set meta(a){this._meta=
a}get description(){return this._description}set description(a){this._description="string"===typeof a?a:this._description}get units(){return this._units}set units(a){this._units="string"===typeof a?a:this._units}get ref(){return this._ref}set ref(a){this._ref=void 0===a||"string"!==typeof a&&!h(a)?null:a}get root(){return this._rootNode}get nodes(){return[...this.G.keys()]}getNode(a){return[...this.G.keys()].find((b)=>b.id===a)}get graph(){return this.G}get topo(){return W(this.G)}get leafs(){return B(this.G).Q}get orphans(){const a=
[];for(const [b,c]of this.G.entries())0===c.size&&b!==this._rootNode&&a.push(b);return a}get names(){return this.nodes.map((a)=>a.name)}get topoNames(){return this.topo.map((a)=>a.name)}get ids(){return this.nodes.map((a)=>a.id)}get topoIds(){return this.topo.map((a)=>a.id)}makeNode(a){a=this._nodeMaker(a);this.G.set(a,new Set);return a}addNode(a){if(!(a instanceof l)||this.ids.includes(a.id))return!1;if(this.G.has(a))return a;this.G.set(a,new Set);this._nodeMaker=D(d(Math.max(...this.ids)));return a}delNode(a){let b=
!1;if(a&&a instanceof l&&a!==this._rootNode&&(b=this.G.delete(a)))for(const [b,d]of this.G.entries())d.delete(a),b.delArg(a);return b}connect(a,b){if(!(a instanceof l&&b instanceof l))return!1;if(a===this.root||b===this.root&&0<this.indegrees(b).length||!this.G.has(a)||!this.G.has(b)||this.G.get(a).has(b))return this;this.G.get(a).add(b);b.addArg(a);this.topo.length<this.nodes.length&&this.disconnect(a,b);return this}disconnect(a,b){if(!(a instanceof l&&b instanceof l))return!1;this.G.has(a)&&(this.G.get(a).delete(b),
b.delArg(a));return this}clean(){this.orphans.forEach((a)=>this.delNode(a));this.orphans.length&&this.clean();this.nodes.forEach((a)=>a.clean());return this}indegrees(a){if(!(a instanceof l))return!1;a=l.isIn(a);return[...this.G.entries()].reduce(a,[])}outdegrees(a){return a instanceof l?[...this.G.get(a)]:!1}getIdG(){return[...this.G].reduce((a,[b,c])=>a.set(b.id,new Set([...c].map(A))),new Map)}solve(a){return this.getSolver()(a)}debug(a){return this.getSolver(!0)(a)}debugFormatter(a){return a.set("topoNames",
this.topoNames)}getSolver(a=!1){const b=C(this.getIdG()),c=this.topo.filter((a)=>b.has(a.id)),d=c.map(A),f=c.map((a)=>a.clean()),e=this._rootNode.id,h=new Map;h.set("topoIds",d);return(b)=>{h.set("data",b);b=f.reduce((a,b)=>b.solve(a),h);return a?this.debugFormatter(b):b.get(e)}}dump(){return JSON.stringify({M:[this.description,this.units,this.ref],G:[...this.getIdG()].map(([a,b])=>[a,[...b]]),N:this.topo.map((a)=>a.dump())})}dotPlot(a){a=void 0!==a?this.debug(a):void 0;return V(this,a)}static read(a){const b=
G(a);if(b)try{const a=b.N.map((a)=>new l(-1,void 0,a)),d=(a)=>(b)=>b.id===a,f=new Map(b.G),e=new E;e.G=new Map;for(const b of f.keys())e.addNode(a.find(d(b)));e._rootNode=e.nodes[0];for(const [b,c]of f.entries()){const f=a.find(d(b));c.forEach((b)=>{b=a.find(d(b));e.connect(f,b)})}e.nodes.forEach((a)=>{a.setAllArgs(b.N.find((b)=>b.I===a.id).A)});e.description=b.M?b.M[0]||"":"";e.units=b.M?b.M[1]||"":"";e.ref=b.M?b.M[2]:null;return e}catch(c){console.log(c)}}}return E}();
